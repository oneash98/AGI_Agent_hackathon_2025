# 건강검진 결과 해석 및 병원 추천 시스템

## 프로젝트 개요
이 프로젝트는 사용자가 업로드한 건강검진 결과 이미지를 OCR 및 구조 인식 기술을 통해 분석하여, JSON 형태의 건강 정보를 추출합니다. 이를 바탕으로 친근한 건강 팁, 임상적으로 정확한 전문 요약, LLM을 활용한 쉬운 설명을 제공하며, 사용자의 위치 정보를 활용하여 적합한 병원이나 약국을 추천하는 통합 솔루션입니다.

## Quickstart
1. **레포지토리 클론**
   ```bash
   git clone <repository_url>
   cd <repository_directory>
   ```

2. **환경 변수 설정**  
   프로젝트 루트 디렉토리에 `.env` 파일을 생성하거나, 스트림릿 실행 환경에서 `st.secrets`를 사용하여 아래 API 키들을 설정합니다.
   - `API_KEY`: Upstage API Key (OCR, 정보 추출, LLM 호출용)
   - `GOOGLE_MAPS_API_KEY`: 구글 맵 API Key (지도 연동 및 병원 위치 표시용)

3. **필수 라이브러리 설치**  
   제공된 `requirements.txt` 파일을 사용하여 필요한 패키지를 한 번에 설치합니다.
   ```bash
   pip install -r requirements.txt
   ```

4. **프로젝트 실행**  
   Streamlit 기반 UI를 실행합니다.
   ```bash
   streamlit run UI.py
   ```

## Requirements 설치 방법
1. **Python 3.7 이상**이 설치되어 있어야 합니다.
2. **필수 패키지**  
   프로젝트에 필요한 주요 패키지는 다음과 같습니다:
   - `streamlit`
   - `streamlit-geolocation`
   - `streamlit-pdf-viewer`
   - `pandas`
   - `Pillow`
   - `python-dotenv`
   - `requests`
   - `beautifulsoup4`
   - `numpy`
   - `scipy`
   - `langchain`
   - `openai`
   
   위 패키지들은 `requirements.txt` 파일에 명시되어 있으므로, 아래 명령어로 설치할 수 있습니다.
   ```bash
   pip install -r requirements.txt
   ```

## 기능 설명
### 1. 사용자 초기 입력
- **입력 항목**: 닉네임(20자 이하), 나이대(10대~90대), 성별, 사는 곳(시/동/구)
- **역할**: 추후 개인 맞춤형 건강 정보 및 병원 추천에 활용되는 기본 사용자 정보를 입력받습니다.

### 2. 건강검진 결과 업로드
- **기능**: 사용자가 스마트폰이나 기타 디바이스로 촬영한 건강검진 결과 이미지를 업로드합니다.
- **파일 유형**: PDF, JPG, JPEG, PNG 등 다양한 이미지 형식을 지원하며, 업로드된 파일은 `uploaded_files` 디렉토리에 저장됩니다.

### 3. Information Extraction (OCR + 구조 인식)
- **목적**: 업로드된 이미지에서 OCR 기술을 통해 텍스트를 추출하고, 구조 인식을 통해 건강검진 결과를 JSON 포맷으로 변환합니다.
- **주요 추출 항목**:  
  - 신체 계측: 키, 몸무게, 체질량지수, 허리둘레
  - 혈액 검사: 혈압, 혈색소, 공복혈당, 콜레스테롤, 중성지방 등
  - 기타 검사 결과: 간 기능, 신장 기능, 흉부촬영 결과 등
- **API 사용**: Upstage API를 활용하여 이미지 인코딩 및 정보 추출을 수행합니다.

### 4. 추가 기능: 친근한 정보 제공
- **설명**: 이미지 → JSON 변환 과정에 시간이 소요될 경우, 미리 준비된 `friendlyInformation.csv` 파일에 담긴 90가지 건강 상식 중 무작위로 하나를 선택하여 사용자에게 유용한 건강 팁을 제공합니다.

### 5. 전문적 요약
- **목적**: 추출된 JSON 데이터를 임상적으로 해석하여, 전문 의료진의 판단에 가까운 요약 정보를 생성합니다.
- **내용**: 각 건강 지표에 대한 임상적 해석과 주의사항을 포함하여, 사용자에게 추가적인 정보를 제공합니다.

### 6. LLM을 이용한 친근한 설명 제공
- **기능**: 전문적 요약과 추출된 JSON 정보를 기반으로 LLM(예: Solar LLM)을 활용, 사용자가 이해하기 쉬운 친근한 건강 요약 문구를 생성합니다.
- **특징**: 어려운 의학 용어 대신 일상 언어를 사용하여, 환자에게 감정적으로도 지원하는 설명을 제공합니다.

### 7. Chatbot UI - 추가 질의 RAG 시스템 (벡터 DB + Solar Embedding)
- **역할**: 사용자가 추가적인 건강 관련 질문(예: “고혈압은 어떻게 관리하나요?”)을 입력하면, RAG(Recuperative Augmented Generation) 시스템을 통해 미리 준비된 질환 가이드라인 스니펫을 검색합니다.
- **기술**:
  - **벡터화**: Solar Embedding을 이용하여 입력 질의와 미리 전처리된 가이드라인 스니펫 간의 유사도를 계산합니다.
  - **검색**: FAISS 기반 벡터 DB에서 유사도가 높은 상위 2~3개 스니펫을 조회합니다.
  - **응답 생성**: 조회된 스니펫과 전문 요약 정보를 바탕으로, LLM이 친절한 답변을 생성하여 사용자에게 제공합니다.

### 8. 병원 추천(지도 연동 등)
- **목적**: 사용자의 건강검진 결과와 위치 정보를 기반으로 가장 적합한 병원이나 약국을 추천합니다.
- **프로세스**:
  - **진료과 추천**: 추출된 건강 정보를 분석하여, 가정의학과, 내과(혈액내과, 신장내과, 심장내과 등), 소화기내과, 내분비내과 중 적절한 진료과를 결정합니다.
  - **지도 연동**: 추천된 진료과에 해당하는 병원 정보를 구글 맵 API를 통해 지도와 함께 시각적으로 제공합니다.
  - **결과 표시**: 추천 병원 정보(병원 이름, 주소, 전화번호, 홈페이지 링크 등)를 사용자 인터페이스(UI)에 출력합니다.

## 미완성 코드들
- **UI.py**:  
  - **역할**: Streamlit을 이용한 사용자 인터페이스 구성.
  - **기능**: API 키 입력, 파일 업로드, 파일 미리보기, 결과 출력(요약, 진료과 추천, 병원 추천 및 지도 연동) 및 위치 정보 활용.
  
- **main.py**:  
  - **역할**: 핵심 기능 로직 구현.
  - **기능**:  
    - 이미지 인코딩 및 OCR 정보 추출
    - 건강 정보 JSON 변환
    - 전문적 요약 및 친근한 설명 생성
    - 진료과 추천 및 병원 추천 기능 구현 (KDTree를 통한 근접 병원 검색 등)

## 프로젝트 실행 예시
1. **API Key 입력**:  
   사이드바에 Upstage API Key와 구글 맵 API Key를 입력합니다.
   
2. **파일 업로드**:  
   건강검진 결과 이미지(PDF, JPG, JPEG, PNG)를 업로드합니다.
   
3. **분석 및 결과 확인**:  
   업로드된 파일을 바탕으로 OCR 및 정보 추출이 진행되고, 친근한 건강 팁, 전문적 요약, 진료과 추천 결과가 화면에 표시됩니다.
   
4. **병원 추천 및 지도 확인**:  
   '병원 추천' 버튼을 클릭하면, 사용자의 위치 정보를 기반으로 적절한 병원 목록과 구글 맵이 함께 출력됩니다.
   
5. **추가 질문 대응**:  
   챗봇 인터페이스를 통해 추가적인 건강 관련 질문에 대해 친절하고 상세한 답변을 제공합니다.
